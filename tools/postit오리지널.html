
        // ê°œë°œì ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ì—­ ì‹œì‘
        // ==============================
        
        // í¬ìŠ¤íŠ¸ì‡ íƒ€ì…ê³¼ ìƒ‰ìƒ ì •ì˜
        const noteTypes = {
            default: '#ffeb3b',  // ë…¸ë€ìƒ‰ (ê¸°ë³¸)
            important: '#ff8a65', // ì£¼í™©ìƒ‰ (ì¤‘ìš”)
            idea: '#81d4fa',     // í•˜ëŠ˜ìƒ‰ (ì•„ì´ë””ì–´)
            reminder: '#ce93d8', // ë³´ë¼ìƒ‰ (ë¦¬ë§ˆì¸ë”)
            personal: '#a5d6a7'  // ë…¹ìƒ‰ (ê°œì¸)
        };
        
        // ìƒˆë¡œ ìƒì„±ë˜ëŠ” ë…¸íŠ¸ì˜ ê¸°ë³¸ íƒ€ì…
        const defaultNoteType = 'default';
        
        // ìƒˆ ë…¸íŠ¸ì˜ ê¸°ë³¸ ìœ„ì¹˜ (í™”ë©´ ì¤‘ì•™)
        const defaultNotePosition = { left: '50%', top: '50%' };
        
        // ==============================
        // ê°œë°œì ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ì—­ ë

        document.addEventListener('DOMContentLoaded', () => {
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = document.getElementById('canvas');
            const addNoteBtn = document.getElementById('add-note-btn');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const zoomResetBtn = document.getElementById('zoom-reset');
            const zoomLevelDisplay = document.getElementById('zoom-level');
            const canvasSelect = document.getElementById('canvas-select');
            const canvasTitleInput = document.getElementById('canvas-title');
            const saveCanvasBtn = document.getElementById('save-canvas-btn');
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const newCanvasModal = document.getElementById('new-canvas-modal');
            const newCanvasTitleInput = document.getElementById('new-canvas-title');
            const confirmNewCanvasBtn = document.getElementById('confirm-new-canvas');
            const cancelNewCanvasBtn = document.getElementById('cancel-new-canvas');
            const contextMenu = document.getElementById('context-menu');
            const contextAddNote = document.getElementById('context-add-note');
            const contextAlignNotes = document.getElementById('context-align-notes');
            let lastRightClickPosition = { x: 0, y: 0 };
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const opacitySlider = document.getElementById('opacity-slider');
            const opacityValue = document.getElementById('opacity-value');
            let isDraggingCanvas = false;
            let dragStartX = 0;
            let dragStartY = 0;
            
            let searchResults = [];
            let currentSearchIndex = -1;
            let currentSearchTerm = '';
            
            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let currentCanvasId = null;
            let canvases = {};
            
            // ì´ˆê¸°í™”
            init();
            
            // ì´ˆê¸°í™” í•¨ìˆ˜
            function init() {
                translateX = 0;
                translateY = 0;
                scale = 1;
                isDraggingCanvas = false;
                loadCanvasesFromLocalStorage();
                updateCanvasSelect();
                
                if (Object.keys(canvases).length === 0) {
                    showNewCanvasModal();
                } else {
                    const firstCanvasId = Object.keys(canvases)[0];
                    loadCanvas(firstCanvasId);
                }
                
                setupEventListeners();

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupContextMenu();

                // ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupSearch();

                // íˆ¬ëª…ë„ ì¡°ì ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupOpacityControls();

                setupCanvasDrag(); 

                updateTransform(); // ì´ˆê¸° ìœ„ì¹˜ ì ìš©

                // ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ê°•ì¡° í•´ì œìš©)
                document.addEventListener('click', (e) => {
                    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ë‚˜ ê²€ìƒ‰ ê´€ë ¨ ìš”ì†Œê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê°•ì¡° í•´ì œ
                    if (!e.target.closest('#context-menu') && 
                        !e.target.closest('#search-container') &&
                        !e.target.closest('.note.highlighted')) {
                        clearHighlights();
                        updateSearchButtons();
                    }
                });
                
            }

            // 3. ë“œë˜ê·¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì¶”ê°€ (ìƒˆë¡œ ì‘ì„±)
            function setupCanvasDrag() {
                const canvasContainer = document.getElementById('canvas-container');

                // ë§ˆìš°ìŠ¤ ë‹¤ìš´ ì´ë²¤íŠ¸ (ìˆ˜ì •ëœ ë¶€ë¶„)
                canvasContainer.addEventListener('mousedown', (e) => {
                    // ë©”ëª¨ì§€ë‚˜ ìì‹ ìš”ì†Œ í´ë¦­ì‹œ ë¬´ì‹œ (ë” ì •í™•í•œ ì¡°ê±´)
                    if (!e.target.classList.contains('note') && e.target === canvasContainer) {
                        isDraggingCanvas = true;
                        dragStartX = e.clientX - translateX;
                        dragStartY = e.clientY - translateY;
                        canvasContainer.style.cursor = 'grabbing';
                        e.preventDefault();
                    }
                });

                // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸
                document.addEventListener('mousemove', (e) => {
                    if (!isDraggingCanvas) return;

                    translateX = e.clientX - dragStartX;
                    translateY = e.clientY - dragStartY;
                    updateTransform();
                });

                // ë§ˆìš°ìŠ¤ ì—… ì´ë²¤íŠ¸
                document.addEventListener('mouseup', () => {
                    isDraggingCanvas = false;
                    canvasContainer.style.cursor = 'default';
                });

                // í„°ì¹˜ ì´ë²¤íŠ¸ ì¶”ê°€ (ëª¨ë°”ì¼ ëŒ€ì‘)
                canvasContainer.addEventListener('touchstart', (e) => {
                    if (e.target !== canvasContainer) return;
                    isDraggingCanvas = true;
                    const touch = e.touches[0];
                    dragStartX = touch.clientX - translateX;
                    dragStartY = touch.clientY - translateY;
                    e.preventDefault();
                });

                document.addEventListener('touchmove', (e) => {
                    if (!isDraggingCanvas) return;
                    const touch = e.touches[0];
                    translateX = touch.clientX - dragStartX;
                    translateY = touch.clientY - dragStartY;
                    updateTransform();
                    e.preventDefault();
                });

                document.addEventListener('touchend', () => {
                    isDraggingCanvas = false;
                });
            }

            // íˆ¬ëª…ë„ ì¡°ì ˆ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupOpacityControls() {
                opacitySlider.addEventListener('input', () => {
                    const opacity = opacitySlider.value;
                    opacityValue.textContent = `${opacity}%`;
                    
                    // ëª¨ë“  ë©”ëª¨ì— íˆ¬ëª…ë„ ì ìš©
                    document.querySelectorAll('.note').forEach(note => {
                        note.style.opacity = opacity / 100;
                    });
                    
                    // í˜„ì¬ ìº”ë²„ìŠ¤ê°€ ìˆìœ¼ë©´ íˆ¬ëª…ë„ ì„¤ì • ì €ì¥
                    if (currentCanvasId) {
                        canvases[currentCanvasId].opacity = opacity / 100;
                        saveCurrentCanvas();
                    }
                });
            }

            function showNewCanvasModal() {
                newCanvasTitleInput.value = '';
                newCanvasModal.style.display = 'flex';
                newCanvasTitleInput.focus();
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            function setupEventListeners() {
                addNoteBtn.addEventListener('click', () => {
                    createNote();
                });

                document.getElementById('new-canvas-btn').addEventListener('click', () => {
                    createNewCanvas();
                });

                // ìº”ë²„ìŠ¤ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                document.getElementById('delete-canvas-btn').addEventListener('click', () => {
                    if (!currentCanvasId) return;
                    
                    if (confirm('Are you sure you want to delete this Board? ')) {
                        deleteCanvas(currentCanvasId);
                    }
                });

                // ìº”ë²„ìŠ¤ ë¹„ìš°ê¸° ë²„íŠ¼ ì¶”ê°€
                document.getElementById('clear-canvas-btn').addEventListener('click', () => {
                    if (!currentCanvasId) return;
                    
                    if (confirm('Are you sure you want to delete all notes on the current Board?')) {
                        clearCurrentCanvas();
                    }
                });

                // ìƒˆ ìº”ë²„ìŠ¤ ë²„íŠ¼ - ëª¨ë‹¬ í‘œì‹œë¡œ ë³€ê²½
                document.getElementById('new-canvas-btn').addEventListener('click', () => {
                    showNewCanvasModal();
                });

                // ëª¨ë‹¬ í™•ì¸ ë²„íŠ¼
                confirmNewCanvasBtn.addEventListener('click', () => {
                    const title = newCanvasTitleInput.value.trim();
                    if (title) {
                        createNewCanvas(title);
                        newCanvasModal.style.display = 'none';
                    } else {
                        alert('Please enter the title');
                    }
                });

                // ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼
                cancelNewCanvasBtn.addEventListener('click', () => {
                    newCanvasModal.style.display = 'none';
                    
                    // ìº”ë²„ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìº”ë²„ìŠ¤ ìƒì„±
                    if (Object.keys(canvases).length === 0) {
                        createNewCanvas('New Board');
                    }
                });

                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                newCanvasModal.addEventListener('click', (e) => {
                    if (e.target === newCanvasModal) {
                        newCanvasModal.style.display = 'none';
                        
                        // ìº”ë²„ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìº”ë²„ìŠ¤ ìƒì„±
                        if (Object.keys(canvases).length === 0) {
                            createNewCanvas('New Board');
                        }
                    }
                });

                canvasTitleInput.addEventListener('change', () => {
                    if (!currentCanvasId) return;
                    
                    const newTitle = canvasTitleInput.value.trim();
                    if (!newTitle) return;
                    
                    // ì œëª©ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
                    if (newTitle !== canvases[currentCanvasId].title) {
                        saveAsNewCanvas(newTitle);
                    }
                });
                
                zoomInBtn.addEventListener('click', () => {
                    zoom(1.1);
                });
                
                zoomOutBtn.addEventListener('click', () => {
                    zoom(0.9);
                });
                
                zoomResetBtn.addEventListener('click', () => {
                    resetZoom();
                });
                
                canvasSelect.addEventListener('change', (e) => {
                    if (e.target.value) {
                        loadCanvas(e.target.value);
                    }
                });
                
                saveCanvasBtn.addEventListener('click', () => {
                    saveCurrentCanvas();
                });
                
                exportBtn.addEventListener('click', () => {
                    exportCanvases();
                });
                
                importBtn.addEventListener('click', () => {
                    importCanvases();
                });
                
                
            }
            
            // í™•ëŒ€/ì¶•ì†Œ í•¨ìˆ˜
            function zoom(factor) {
                scale *= factor;
                updateTransform();
                updateZoomLevel();
            }
            
            // í™•ëŒ€/ì¶•ì†Œ ë¦¬ì…‹
            function resetZoom() {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
                updateZoomLevel();
            }
            
            // ë³€í™˜ ì—…ë°ì´íŠ¸
            function updateTransform() {
                const canvas = document.getElementById('canvas');
                canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                
            }
            
            // í™•ëŒ€ ë ˆë²¨ í‘œì‹œ ì—…ë°ì´íŠ¸
            function updateZoomLevel() {
                zoomLevelDisplay.textContent = `${Math.round(scale * 100)}%`;
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìº”ë²„ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
            function loadCanvasesFromLocalStorage() {
                const savedCanvases = localStorage.getItem('stickyNotesCanvases');
                if (savedCanvases) {
                    canvases = JSON.parse(savedCanvases);
                }
            }
            
            // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            function updateCanvasSelect() {
                canvasSelect.innerHTML = '';
                
                Object.keys(canvases).forEach(canvasId => {
                    const option = document.createElement('option');
                    option.value = canvasId;
                    option.textContent = canvases[canvasId].title || `Board ${canvasId}`;
                    canvasSelect.appendChild(option);
                });
                
                // í˜„ì¬ ì„ íƒëœ ìº”ë²„ìŠ¤ í‘œì‹œ
                if (currentCanvasId) {
                    canvasSelect.value = currentCanvasId;
                }
            }
            
            // ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
            function createNewCanvas(title) {
                if (!title || !title.trim()) {
                    alert('Please enter the title of the Board.');
                    return null;
                }
                
                const newCanvasId = Date.now().toString();
                currentCanvasId = newCanvasId;
                
                canvases[newCanvasId] = {
                    id: newCanvasId,
                    title: title.trim(),
                    notes: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    opacity: 1 // ê¸°ë³¸ íˆ¬ëª…ë„
                };
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
                
                // ì œëª© ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                canvasTitleInput.value = title.trim();
                
                // íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
                opacitySlider.value = 100;
                opacityValue.textContent = '100%';
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                return newCanvasId;
            }
            
            // ìº”ë²„ìŠ¤ ë¡œë“œ
            function loadCanvas(canvasId) {
                if (!canvases[canvasId]) return;
                
                currentCanvasId = canvasId;
                const canvasData = canvases[canvasId];
                
                // ì œëª© í‘œì‹œ
                canvasTitleInput.value = canvasData.title || '';
                
                // íˆ¬ëª…ë„ ì„¤ì •
                const opacity = canvasData.opacity !== undefined ? canvasData.opacity : 1;
                opacitySlider.value = opacity * 100;
                opacityValue.textContent = `${opacity * 100}%`;
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë…¸íŠ¸ ë¡œë“œ
                if (canvasData.notes && canvasData.notes.length > 0) {
                    canvasData.notes.forEach(note => {
                        createNote(
                            note.content, 
                            note.type, 
                            note.position, 
                            note.id,
                            note.size, // í¬ê¸° ì •ë³´ ì¶”ê°€
                            note.opacity // íˆ¬ëª…ë„ ì •ë³´ ì¶”ê°€
                        );
                    });
                }
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }
            
            // í˜„ì¬ ìº”ë²„ìŠ¤ ì €ì¥
            function saveCurrentCanvas() {
                if (!currentCanvasId) return;
                
                const title = canvasTitleInput.value.trim();
                
                // ìº”ë²„ìŠ¤ ë°ì´í„° ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ìº”ë²„ìŠ¤ ì—…ë°ì´íŠ¸)
                canvases[currentCanvasId].title = title;
                canvases[currentCanvasId].updatedAt = new Date().toISOString();
                canvases[currentCanvasId].opacity = parseFloat(opacitySlider.value) / 100;
                
                // ë…¸íŠ¸ ë°ì´í„° ìˆ˜ì§‘
                const notes = [];
                const noteElements = document.querySelectorAll('.note');
                
                noteElements.forEach(note => {
                    notes.push({
                        id: note.id,
                        content: note.querySelector('.note-content').value,
                        type: note.querySelector('.note-type').textContent,
                        position: {
                            left: note.style.left,
                            top: note.style.top
                        },
                        size: { // í¬ê¸° ì •ë³´ ì €ì¥
                            width: note.style.width,
                            height: note.style.height
                        },
                        opacity: parseFloat(note.style.opacity || '1'), // íˆ¬ëª…ë„ ì •ë³´ ì €ì¥
                        createdAt: note.querySelector('.note-footer').textContent
                    });
                });
                
                canvases[currentCanvasId].notes = notes;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }
            
            // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
            function clearCanvas() {
                canvas.innerHTML = '';
            }

            // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupContextMenu() {
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆì—ì„œ ìš°í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
                canvasContainer.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    
                    // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ì €ì¥
                    lastRightClickPosition = {
                        x: e.clientX,
                        y: e.clientY
                    };
                    
                    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìœ„ì¹˜ ì„¤ì •
                    contextMenu.style.display = 'block';
                    contextMenu.style.left = `${e.clientX}px`;
                    contextMenu.style.top = `${e.clientY}px`;
                });

                // ë¬¸ì„œ í´ë¦­ ì‹œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìˆ¨ê¸°ê¸°
                document.addEventListener('click', () => {
                    contextMenu.style.display = 'none';
                });

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
                contextAddNote.addEventListener('click', () => {
                    // ë©”ëª¨ ì¶”ê°€ ê¸°ëŠ¥
                    createNoteAtPosition(lastRightClickPosition);
                    contextMenu.style.display = 'none';
                });

                contextAlignNotes.addEventListener('click', () => {
                    // ë©”ëª¨ ì •ë ¬ ê¸°ëŠ¥
                    alignNotesFromPosition(lastRightClickPosition);
                    contextMenu.style.display = 'none';
                });
            }

            // ìœ„ì¹˜ì— ë©”ëª¨ ìƒì„± í•¨ìˆ˜ ì¶”ê°€
            function createNoteAtPosition(position) {
                if (!currentCanvasId) return;
                
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
                const containerRect = canvasContainer.getBoundingClientRect();
                const x = position.x - containerRect.left - translateX;
                const y = position.y - containerRect.top - translateY;
                
                // ìŠ¤ì¼€ì¼ ê³ ë ¤
                const scaledX = x / scale;
                const scaledY = y / scale;
                
                // ë©”ëª¨ ìƒì„±
                const noteId = createNote('', defaultNoteType, {
                    left: `${scaledX}px`,
                    top: `${scaledY}px`
                });
                
                // ì €ì¥
                saveCurrentCanvas();
                
                return noteId;
            }

            // ì‹œì‘ì  ê¸°ì¤€ìœ¼ë¡œ ë©”ëª¨ ì •ë ¬ í•¨ìˆ˜ ì¶”ê°€
            function alignNotesFromPosition(startPosition) {
                if (!currentCanvasId || !canvases[currentCanvasId] || !canvases[currentCanvasId].notes) return;
                
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
                const containerRect = canvasContainer.getBoundingClientRect();
                const startX = (startPosition.x - containerRect.left - translateX) / scale;
                const startY = (startPosition.y - containerRect.top - translateY) / scale;
                
                // ë©”ëª¨ì§€ í¬ê¸° ë° ê°„ê²©
                const noteWidth = 200; // ë©”ëª¨ì§€ ë„ˆë¹„
                const noteHeight = 200; // ë©”ëª¨ì§€ ë†’ì´
                const margin = 20; // ê°„ê²©
                
                // ë©”ëª¨ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ìƒì„± ì‹œê°„ ê¸°ì¤€ ì •ë ¬)
                const notes = [...canvases[currentCanvasId].notes];
                notes.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                
                // ë©”ëª¨ì§€ DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                const noteElements = Array.from(document.querySelectorAll('.note'));
                
                // ë©”ëª¨ì§€ ì •ë ¬
                notes.forEach((note, index) => {
                    const noteElement = noteElements.find(el => el.id === note.id);
                    if (!noteElement) return;
                    
                    // í–‰/ì—´ ê³„ì‚° (í•œ ì¤„ì— 5ê°œ)
                    const row = Math.floor(index / 5);
                    const col = index % 5;
                    
                    // ìœ„ì¹˜ ê³„ì‚°
                    const x = startX + col * (noteWidth + margin);
                    const y = startY + row * (noteHeight + margin);
                    
                    // ìœ„ì¹˜ ì ìš©
                    noteElement.style.left = `${x}px`;
                    noteElement.style.top = `${y}px`;
                    
                    // ë°ì´í„° ì—…ë°ì´íŠ¸
                    note.position = {
                        left: `${x}px`,
                        top: `${y}px`
                    };
                });
                
                // ìº”ë²„ìŠ¤ ë°ì´í„° ì—…ë°ì´íŠ¸
                canvases[currentCanvasId].notes = notes;
                saveCurrentCanvas();
            }
            
            // ë…¸íŠ¸ ìƒì„± í•¨ìˆ˜ (í¬ê¸°ì™€ íˆ¬ëª…ë„ íŒŒë¼ë¯¸í„° ì¶”ê°€)
            function createNote(content = '', type = defaultNoteType, position = null, noteId = null, size = null, noteOpacity = null) {
                noteId = noteId || Date.now().toString();
                const note = document.createElement('div');
                note.className = 'note';
                note.id = noteId;
                note.style.backgroundColor = noteTypes[type] || noteTypes[defaultNoteType];
                
                // íˆ¬ëª…ë„ ì ìš© (ê°œë³„ ë…¸íŠ¸ íˆ¬ëª…ë„ ë˜ëŠ” ì „ì²´ íˆ¬ëª…ë„)
                const opacity = noteOpacity !== null ? noteOpacity : parseFloat(opacitySlider.value) / 100;
                note.style.opacity = opacity;
                
                // ìœ„ì¹˜ ì„¤ì •
                if (position) {
                    note.style.left = position.left;
                    note.style.top = position.top;
                } else {
                    // í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜
                    const canvasRect = canvas.getBoundingClientRect();
                    note.style.left = `${canvasRect.width / 2 - 100}px`;
                    note.style.top = `${canvasRect.height / 2 - 100}px`;
                }
                
                // í¬ê¸° ì„¤ì •
                if (size && size.width && size.height) {
                    note.style.width = size.width;
                    note.style.height = size.height;
                } else {
                    note.style.width = '200px';
                    note.style.height = '200px';
                }
                
                // ë…¸íŠ¸ ë‚´ìš©
                note.innerHTML = `
                    <div class="note-header">
                        <span class="note-type">${type}</span>
                        <div class="note-actions">
                            <button class="change-type-btn">âœï¸</button>
                            <button class="delete-btn">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <textarea class="note-content" placeholder="Input Memo...">${content}</textarea>
                    <div class="note-footer">${new Date().toLocaleDateString()}
                        <div class="resize-handle"></div>
                    </div>
                `;
                
                canvas.appendChild(note);
                
                // ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€
                makeDraggable(note);
                
                // í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ ì¶”ê°€
                setupResizeHandle(note);
                
                // ë…¸íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                const deleteBtn = note.querySelector('.delete-btn');
                const changeTypeBtn = note.querySelector('.change-type-btn');
                const noteContent = note.querySelector('.note-content');
                
                deleteBtn.addEventListener('click', () => {
                    deleteNote(noteId);
                });
                
                changeTypeBtn.addEventListener('click', () => {
                    changeNoteType(noteId);
                });
                
                noteContent.addEventListener('input', () => {
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                });
                
                return noteId;
            }
            
            // ë…¸íŠ¸ ë“œë˜ê·¸ ê¸°ëŠ¥
            function makeDraggable(note) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                let isDragging = false;
            
                function dragMouseDown(e) {
                    // ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ì„ í´ë¦­í•œ ê²½ìš° ë“œë˜ê·¸ ê¸ˆì§€
                    if (e.target.classList.contains('resize-handle')) {
                        return;
                    }
                    
                    // í…ìŠ¤íŠ¸ í¸ì§‘ ì¤‘ì—ëŠ” ë“œë˜ê·¸ ê¸ˆì§€
                    if (e.target.tagName === 'TEXTAREA') {
                        return;
                    }
                    
                    e.preventDefault();
                    
                    // ë“œë˜ê·¸ ì‹œì‘ ìœ„ì¹˜
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                    note.style.cursor = 'grabbing';
                    isDragging = true;
                }
                
                function elementDrag(e) {
                    if (!isDragging) return;
                    
                    e = e || window.event;
                    e.preventDefault();
                    
                    // ìƒˆ ìœ„ì¹˜ ê³„ì‚°
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    
                    // ë…¸íŠ¸ ìœ„ì¹˜ ì„¤ì • (ìŠ¤ì¼€ì¼ ê³ ë ¤)
                    const currentLeft = parseFloat(note.style.left || '0');
                    const currentTop = parseFloat(note.style.top || '0');
                    
                    note.style.left = (currentLeft - pos1 / scale) + "px";
                    note.style.top = (currentTop - pos2 / scale) + "px";
                    
                    // ìœ„ì¹˜ ë³€ê²½ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                    note.style.cursor = 'grab';
                    isDragging = false;
                }
                
                note.onmousedown = dragMouseDown;
            }
            
            // ë…¸íŠ¸ í¬ê¸° ì¡°ì ˆ í•¸ë“¤ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupResizeHandle(note) {
                const resizeHandle = note.querySelector('.resize-handle');
                let startX, startY, startWidth, startHeight;
                
                resizeHandle.addEventListener('mousedown', initResize);
                
                function initResize(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // ì‹œì‘ ìœ„ì¹˜ ë° í¬ê¸° ì €ì¥
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = parseInt(document.defaultView.getComputedStyle(note).width, 10);
                    startHeight = parseInt(document.defaultView.getComputedStyle(note).height, 10);
                    
                    document.onmousemove = resize;
                    document.onmouseup = stopResize;
                }
                
                function resize(e) {
                    // ìµœì†Œ í¬ê¸° ì„¤ì • (100px)
                    const minWidth = 100;
                    const minHeight = 100;
                    
                    // ìƒˆ í¬ê¸° ê³„ì‚°
                    let newWidth = startWidth + (e.clientX - startX) / scale;
                    let newHeight = startHeight + (e.clientY - startY) / scale;
                    
                    // ìµœì†Œ í¬ê¸° ì œí•œ
                    newWidth = Math.max(newWidth, minWidth);
                    newHeight = Math.max(newHeight, minHeight);
                    
                    // í¬ê¸° ì ìš©
                    note.style.width = `${newWidth}px`;
                    note.style.height = `${newHeight}px`;
                }
                
                function stopResize() {
                    document.onmousemove = null;
                    document.onmouseup = null;
                    
                    // í¬ê¸° ë³€ê²½ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
            }
            
            // ë…¸íŠ¸ íƒ€ì… ë³€ê²½
            function changeNoteType(noteId) {
                const note = document.getElementById(noteId);
                if (!note) return;
                
                const currentType = note.querySelector('.note-type').textContent;
                const types = Object.keys(noteTypes);
                const currentIndex = types.indexOf(currentType);
                const nextIndex = (currentIndex + 1) % types.length;
                const nextType = types[nextIndex];
                
                note.querySelector('.note-type').textContent = nextType;
                note.style.backgroundColor = noteTypes[nextType];
                
                // íƒ€ì… ë³€ê²½ ì‹œ ìë™ ì €ì¥
                if (currentCanvasId) {
                    saveCurrentCanvas();
                }
            }

            // ê²€ìƒ‰ ê¸°ëŠ¥ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupSearch() {
                // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                searchBtn.addEventListener('click', () => {
                    
                    const term = searchInput.value.trim();
                    if (term) {
                        searchNotes(term);
                    }
                });

                // ì´ì „ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                prevBtn.addEventListener('click', () => {

                    navigateSearchResult(-1); // -1ì€ ì´ì „ ê²°ê³¼ë¡œ ì´ë™
                });

                // ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                nextBtn.addEventListener('click', () => {

                    navigateSearchResult(1); // 1ì€ ë‹¤ìŒ ê²°ê³¼ë¡œ ì´ë™
                });

                // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰ ê°€ëŠ¥
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const term = searchInput.value.trim();
                        if (term) {
                            searchNotes(term);
                        }
                    }
                });
            }

            // í•˜ì´ë¼ì´íŠ¸ ì œê±° í•¨ìˆ˜ ìˆ˜ì • (ë²„íŠ¼ ìƒíƒœë„ í•¨ê»˜ ì—…ë°ì´íŠ¸)
            function clearHighlights() {
                document.querySelectorAll('.note.highlighted').forEach(note => {
                    note.classList.remove('highlighted');
                });
            }

            // ë©”ëª¨ ê²€ìƒ‰ í•¨ìˆ˜ ì¶”ê°€
            function searchNotes(term) {
                if (!currentCanvasId || !canvases[currentCanvasId]) return;
                
                 // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearHighlights();
                
                // ê²€ìƒ‰ì–´ ì €ì¥
                currentSearchTerm = term;
                
                // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
                searchResults = [];
                
                // í˜„ì¬ ìº”ë²„ìŠ¤ì˜ ëª¨ë“  ë©”ëª¨ì—ì„œ ê²€ìƒ‰
                const notes = canvases[currentCanvasId].notes;
                notes.forEach(note => {
                    const noteElement = document.getElementById(note.id);
                    if (noteElement && note.content.includes(term)) {
                        searchResults.push(note.id);
                    }
                });
                
                if (searchResults.length > 0) {
                    currentSearchIndex = 0;
                    highlightNote(searchResults[currentSearchIndex]);
                    centerNote(searchResults[currentSearchIndex]);
                    
                    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateSearchButtons();
                } else {
                    alert('No notes were found that matched the search term.');
                    currentSearchIndex = -1;
                    updateSearchButtons();
                }
                
            }

            // ê²€ìƒ‰ ê²°ê³¼ íƒìƒ‰ í•¨ìˆ˜ ì¶”ê°€
            function navigateSearchResult(direction) {
                if (searchResults.length === 0) return;
            
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearHighlights();
                
                // ìƒˆë¡œìš´ ì¸ë±ìŠ¤ ê³„ì‚° (ìˆœí™˜)
                
                currentSearchIndex += direction;
                
                if (currentSearchIndex >= searchResults.length) {
                    currentSearchIndex = 0; // ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°
                } else if (currentSearchIndex < 0) {
                    currentSearchIndex = searchResults.length - 1; // ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë™
                }
                
                // ìƒˆ ë©”ëª¨ í•˜ì´ë¼ì´íŠ¸ ë° ì¤‘ì•™ ì •ë ¬
                highlightNote(searchResults[currentSearchIndex]);
                centerNote(searchResults[currentSearchIndex]);
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateSearchButtons();
            }

            // ë©”ëª¨ í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
            function highlightNote(noteId) {
                const note = document.getElementById(noteId);
                if (note) {
                    note.classList.add('highlighted');
                }
            }

            // ë©”ëª¨ë¥¼ ì¤‘ì•™ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
            function centerNote(noteId) {
                const note = document.getElementById(noteId);
                if (!note) return;
                
                // ë©”ëª¨ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const noteRect = note.getBoundingClientRect();
                const containerRect = canvasContainer.getBoundingClientRect();
                
                // ë©”ëª¨ì˜ ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
                const noteCenterX = noteRect.left + noteRect.width / 2;
                const noteCenterY = noteRect.top + noteRect.height / 2;
                
                // ì»¨í…Œì´ë„ˆì˜ ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
                const containerCenterX = containerRect.width / 2;
                const containerCenterY = containerRect.height / 2;
                
                // ì´ë™í•´ì•¼ í•  ê±°ë¦¬ ê³„ì‚°
                const moveX = containerCenterX - noteCenterX;
                const moveY = containerCenterY - noteCenterY;
                
                // í˜„ì¬ ë³€í™˜ ê°’ì— ì´ë™ ê±°ë¦¬ ì¶”ê°€
                translateX += moveX;
                translateY += moveY;
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                updateTransform();
            }

            // ê²€ìƒ‰ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
            function updateSearchButtons() {
                prevBtn.disabled = searchResults.length === 0;
                nextBtn.disabled = searchResults.length === 0;
                
                if (searchInput.value.trim() !== currentSearchTerm) {
                    searchBtn.disabled = false;
                    prevBtn.disabled = true;
                    nextBtn.disabled = true;
                } else {
                    searchBtn.disabled = false;
                }
            }

            // ìƒˆ ìº”ë²„ìŠ¤ë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
            function saveAsNewCanvas(title) {
                if (!currentCanvasId) return;
                
                const oldCanvas = canvases[currentCanvasId];
                const newCanvasId = Date.now().toString();
                
                // ìƒˆ ìº”ë²„ìŠ¤ ìƒì„± (ê¸°ì¡´ ë°ì´í„° ë³µì‚¬)
                canvases[newCanvasId] = {
                    id: newCanvasId,
                    title: title,
                    notes: JSON.parse(JSON.stringify(oldCanvas.notes)), // ê¹Šì€ ë³µì‚¬
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    opacity: parseFloat(opacitySlider.value) / 100 // í˜„ì¬ íˆ¬ëª…ë„ ì €ì¥
                };
                
                // í˜„ì¬ ìº”ë²„ìŠ¤ ID ì—…ë°ì´íŠ¸
                currentCanvasId = newCanvasId;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // UI ì—…ë°ì´íŠ¸
                updateCanvasSelect();
                
                // ì œëª© í•„ë“œì— ìƒˆ ì œëª© í‘œì‹œ
                canvasTitleInput.value = title;
                
                alert('You have been saved as a new board.');
            }

            // ìº”ë²„ìŠ¤ ì‚­ì œ í•¨ìˆ˜ ì¶”ê°€
            function deleteCanvas(canvasId) {
                if (!canvases[canvasId]) return;
                
                // ìº”ë²„ìŠ¤ ì‚­ì œ
                delete canvases[canvasId];
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // ë‹¤ë¥¸ ìº”ë²„ìŠ¤ê°€ ìˆëŠ” ê²½ìš° ì²« ë²ˆì§¸ ìº”ë²„ìŠ¤ ë¡œë“œ
                if (Object.keys(canvases).length > 0) {
                    const firstCanvasId = Object.keys(canvases)[0];
                    loadCanvas(firstCanvasId);
                } else {
                    // ìº”ë²„ìŠ¤ê°€ ì—†ëŠ” ê²½ìš° ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
                    createNewCanvas();
                }
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }

            // í˜„ì¬ ìº”ë²„ìŠ¤ ë¹„ìš°ê¸° í•¨ìˆ˜ ì¶”ê°€
            function clearCurrentCanvas() {
                if (!currentCanvasId) return;
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                canvases[currentCanvasId].notes = [];
                canvases[currentCanvasId].updatedAt = new Date().toISOString();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
            }

            // ë…¸íŠ¸ ì‚­ì œ
            function deleteNote(noteId) {
                const note = document.getElementById(noteId);
                if (note) {
                    note.remove();
                    // ë…¸íŠ¸ ì‚­ì œ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
            }
            
            // ìº”ë²„ìŠ¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            function exportCanvases() {
                if (Object.keys(canvases).length === 0) {
                    alert('There are no board to export.');
                    return;
                }
                
                const dataStr = JSON.stringify(canvases, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `sticky-notes-${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
            
            // ìº”ë²„ìŠ¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            function importCanvases() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const importedCanvases = JSON.parse(event.target.result);
                            
                            // ê¸°ì¡´ ìº”ë²„ìŠ¤ì™€ ë³‘í•©
                            canvases = { ...canvases, ...importedCanvases };
                            
                            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                            localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                            
                            // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                            updateCanvasSelect();
                            
                            // ì²« ë²ˆì§¸ ìº”ë²„ìŠ¤ ë¡œë“œ
                            const firstCanvasId = Object.keys(importedCanvases)[0];
                            loadCanvas(firstCanvasId);
                            
                            alert('Success Load');
                        } catch (error) {
                            alert('error: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            }
        });
