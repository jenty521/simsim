<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticky Notes ë©”ëª¨ì¥</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }

        .modal-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .modal-btn.confirm {
            background-color: #4a90e2;
            color: white;
        }

        .modal-btn.cancel {
            background-color: #f0f0f0;
        }


        #header {
            display: flex;
            padding: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            align-items: center;
            gap: 10px;
            z-index: 200;
        }

        #canvas-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 150px;
        }

        #canvas-title {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex-grow: 1;
            max-width: 200px;
        }

        .header-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background-color: #4a90e2;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .header-btn:hover {
            background-color: #357abd;
        }

        .header-btn.danger {
            background-color: #e74c3c;
        }

        .header-btn.danger:hover {
            background-color: #c0392b;
        }

        #canvas-container {
            position: absolute;
            width: 100%;
            height: calc(100vh - 80px); /* íˆ¬ëª…ë„ ì»¨íŠ¸ë¡¤ëŸ¬ ê³µê°„ í™•ë³´ */
            overflow: hidden;
            background-color: #f5f5f5;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: center;
            transition: transform 0.3s ease;
            touch-action: none;
            user-select: none; /* ë“œë˜ê·¸ ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }
        

        #canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            cursor: default;
            pointer-events: none; /* ìº”ë²„ìŠ¤ ìì²´ê°€ ì´ë²¤íŠ¸ë¥¼ ë§‰ì§€ ì•Šë„ë¡ */
        }

        .note {
            position: absolute;
            width: 200px;
            min-height: 200px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 2px;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.3s ease;
            cursor: grab;
            resize: none;
            overflow: hidden;
            pointer-events: auto; /* ë©”ëª¨ì§€ë§Œ ì´ë²¤íŠ¸ ì²˜ë¦¬ */
        }

        .note:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .note-type {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .note-actions {
            display: flex;
            gap: 5px;
        }

        .note-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .note-actions button:hover {
            opacity: 1;
        }

        .note-content {
            flex-grow: 1;
            outline: none;
            overflow-wrap: break-word;
            resize: none;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 10px;
            overflow: auto;
        }

        .note-footer {
            font-size: 10px;
            color: rgba(0, 0, 0, 0.5);
            text-align: right;
            position: relative;
            padding-right: 10px;
        }

        .resize-handle {
            position: absolute;
            right: -15px;
            bottom: -15px;
            width: 10px;
            height: 10px;
            background-color: rgba(240, 18, 18, 0.932);
            cursor: nwse-resize;
            border-radius: 2px;
        }

        #add-note-btn {
            position: fixed;
            bottom: 70px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ffeb3b;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
        }

        #add-note-btn:hover {
            background-color: #fdd835;
        }

        #zoom-controls {
            position: fixed;
            bottom: 130px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 100;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background-color: #f5f5f5;
        }

        #zoom-level {
            position: fixed;
            bottom: 180px;
            right: 30px;
            background-color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }


        #context-menu {
            position: absolute;
            display: none;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
        }

        .context-menu-item:hover {
            background-color: #f5f5f5;
        }

        .context-menu-divider {
            height: 1px;
            background-color: #eee;
            margin: 4px 0;
        }

         /* ê²€ìƒ‰ ì˜ì—­ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
         #search-container {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        #search-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
        }

        .search-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background-color: #4a90e2;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-btn:hover {
            background-color: #357abd;
        }

        .search-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* ê²€ìƒ‰ëœ ë©”ëª¨ í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ */
        .note.highlighted {
            box-shadow: 0 0 0 3px #ff5722;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* íˆ¬ëª…ë„ ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤íƒ€ì¼ */
        #opacity-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        #opacity-slider {
            flex-grow: 1;
            margin: 0 10px;
        }

        #opacity-value {
            width: 40px;
            text-align: center;
            font-size: 12px;
        }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7NY0VN0ECJ"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', 'G-7NY0VN0ECJ');
    </script>
<!--êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤ ì¢…ë£Œ-->
<!--êµ¬ê¸€ ì• ë“œì„¼ìŠ¤ ìë™ê´‘ê³  ì‹œì‘-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4624141391435876"  crossorigin="anonymous"></script>
</head>
<body>
    <div id="header">
        <select id="canvas-select"></select>
        <input type="text" id="canvas-title" placeholder="ìº”ë²„ìŠ¤ ì œëª©">
        <button id="save-canvas-btn" class="header-btn">ìº”ë²„ìŠ¤ ì €ì¥</button>
        <button id="new-canvas-btn" class="header-btn">ìƒˆ ìº”ë²„ìŠ¤</button>
        <button id="clear-canvas-btn" class="header-btn">ìº”ë²„ìŠ¤ ë¹„ìš°ê¸°</button>
        <button id="delete-canvas-btn" class="header-btn danger">ìº”ë²„ìŠ¤ ì‚­ì œ</button>
        <button id="export-btn" class="header-btn">íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
        <button id="import-btn" class="header-btn">íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        
        <!-- ê²€ìƒ‰ ì˜ì—­ ì¶”ê°€ -->
        <div id="search-container">
            <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
            <button id="search-btn" class="search-btn">ê²€ìƒ‰</button>
            <button id="prev-btn" class="search-btn" disabled>ì´ì „</button>
            <button id="next-btn" class="search-btn" disabled>ë‹¤ìŒ</button>
        </div>
    </div>

    <!-- ëª¨ë‹¬ ì°½ ì¶”ê°€ -->
    <div id="new-canvas-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ìƒˆ ìº”ë²„ìŠ¤ ì œëª© ì…ë ¥</div>
            <input type="text" id="new-canvas-title" class="modal-input" placeholder="ìº”ë²„ìŠ¤ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="modal-actions">
                <button id="cancel-new-canvas" class="modal-btn cancel">ì·¨ì†Œ</button>
                <button id="confirm-new-canvas" class="modal-btn confirm">ìƒì„±</button>
            </div>
        </div>
    </div>
    
    <div id="canvas-container">
        <div id="canvas"></div>
    </div>
    
    <!-- íˆ¬ëª…ë„ ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€ -->
    <div id="opacity-controls">
        <span>íˆ¬ëª…ë„:</span>
        <input type="range" id="opacity-slider" min="30" max="100" value="100">
        <span id="opacity-value">100%</span>
    </div>
    
    <div id="zoom-controls">
        <button class="zoom-btn" id="zoom-in">+</button>
        <button class="zoom-btn" id="zoom-out">-</button>
        <button class="zoom-btn" id="zoom-reset">â†»</button>
    </div>
    <div id="zoom-level">100%</div>
    
    <button id="add-note-btn">+</button>

    <!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì¶”ê°€ -->
    <div id="context-menu">
        <div class="context-menu-item" id="context-add-note">ë©”ëª¨ ì¶”ê°€</div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="context-align-notes">ì‹œì‘ì  ì •ë ¬</div>
    </div>

    <script>
        // ê°œë°œì ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ì—­ ì‹œì‘
        // ==============================
        
        // í¬ìŠ¤íŠ¸ì‡ íƒ€ì…ê³¼ ìƒ‰ìƒ ì •ì˜
        const noteTypes = {
            default: '#ffeb3b',  // ë…¸ë€ìƒ‰ (ê¸°ë³¸)
            important: '#ff8a65', // ì£¼í™©ìƒ‰ (ì¤‘ìš”)
            idea: '#81d4fa',     // í•˜ëŠ˜ìƒ‰ (ì•„ì´ë””ì–´)
            reminder: '#ce93d8', // ë³´ë¼ìƒ‰ (ë¦¬ë§ˆì¸ë”)
            personal: '#a5d6a7'  // ë…¹ìƒ‰ (ê°œì¸)
        };
        
        // ìƒˆë¡œ ìƒì„±ë˜ëŠ” ë…¸íŠ¸ì˜ ê¸°ë³¸ íƒ€ì…
        const defaultNoteType = 'default';
        
        // ìƒˆ ë…¸íŠ¸ì˜ ê¸°ë³¸ ìœ„ì¹˜ (í™”ë©´ ì¤‘ì•™)
        const defaultNotePosition = { left: '50%', top: '50%' };
        
        // ==============================
        // ê°œë°œì ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ì—­ ë

        document.addEventListener('DOMContentLoaded', () => {
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = document.getElementById('canvas');
            const addNoteBtn = document.getElementById('add-note-btn');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const zoomResetBtn = document.getElementById('zoom-reset');
            const zoomLevelDisplay = document.getElementById('zoom-level');
            const canvasSelect = document.getElementById('canvas-select');
            const canvasTitleInput = document.getElementById('canvas-title');
            const saveCanvasBtn = document.getElementById('save-canvas-btn');
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const newCanvasModal = document.getElementById('new-canvas-modal');
            const newCanvasTitleInput = document.getElementById('new-canvas-title');
            const confirmNewCanvasBtn = document.getElementById('confirm-new-canvas');
            const cancelNewCanvasBtn = document.getElementById('cancel-new-canvas');
            const contextMenu = document.getElementById('context-menu');
            const contextAddNote = document.getElementById('context-add-note');
            const contextAlignNotes = document.getElementById('context-align-notes');
            let lastRightClickPosition = { x: 0, y: 0 };
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const opacitySlider = document.getElementById('opacity-slider');
            const opacityValue = document.getElementById('opacity-value');
            let isDraggingCanvas = false;
            let dragStartX = 0;
            let dragStartY = 0;
            
            let searchResults = [];
            let currentSearchIndex = -1;
            let currentSearchTerm = '';
            
            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let currentCanvasId = null;
            let canvases = {};
            
            // ì´ˆê¸°í™”
            init();
            
            // ì´ˆê¸°í™” í•¨ìˆ˜
            function init() {
                translateX = 0;
                translateY = 0;
                scale = 1;
                isDraggingCanvas = false;
                loadCanvasesFromLocalStorage();
                updateCanvasSelect();
                
                if (Object.keys(canvases).length === 0) {
                    showNewCanvasModal();
                } else {
                    const firstCanvasId = Object.keys(canvases)[0];
                    loadCanvas(firstCanvasId);
                }
                
                setupEventListeners();

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupContextMenu();

                // ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupSearch();

                // íˆ¬ëª…ë„ ì¡°ì ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupOpacityControls();

                setupCanvasDrag(); 

                updateTransform(); // ì´ˆê¸° ìœ„ì¹˜ ì ìš©

                // ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ê°•ì¡° í•´ì œìš©)
                document.addEventListener('click', (e) => {
                    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ë‚˜ ê²€ìƒ‰ ê´€ë ¨ ìš”ì†Œê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê°•ì¡° í•´ì œ
                    if (!e.target.closest('#context-menu') && 
                        !e.target.closest('#search-container') &&
                        !e.target.closest('.note.highlighted')) {
                        clearHighlights();
                        updateSearchButtons();
                    }
                });
                
            }

            // 3. ë“œë˜ê·¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì¶”ê°€ (ìƒˆë¡œ ì‘ì„±)
            function setupCanvasDrag() {
                const canvasContainer = document.getElementById('canvas-container');

                // ë§ˆìš°ìŠ¤ ë‹¤ìš´ ì´ë²¤íŠ¸ (ìˆ˜ì •ëœ ë¶€ë¶„)
                canvasContainer.addEventListener('mousedown', (e) => {
                    // ë©”ëª¨ì§€ë‚˜ ìì‹ ìš”ì†Œ í´ë¦­ì‹œ ë¬´ì‹œ (ë” ì •í™•í•œ ì¡°ê±´)
                    if (!e.target.classList.contains('note') && e.target === canvasContainer) {
                        isDraggingCanvas = true;
                        dragStartX = e.clientX - translateX;
                        dragStartY = e.clientY - translateY;
                        canvasContainer.style.cursor = 'grabbing';
                        e.preventDefault();
                        console.log("ë“œë˜ê·¸ ì‹œì‘", dragStartX, dragStartY); // ë””ë²„ê¹…ìš©
                    }
                });

                // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸
                document.addEventListener('mousemove', (e) => {
                    if (!isDraggingCanvas) return;

                    translateX = e.clientX - dragStartX;
                    translateY = e.clientY - dragStartY;
                    updateTransform();
                });

                // ë§ˆìš°ìŠ¤ ì—… ì´ë²¤íŠ¸
                document.addEventListener('mouseup', () => {
                    isDraggingCanvas = false;
                    canvasContainer.style.cursor = 'default';
                });

                // í„°ì¹˜ ì´ë²¤íŠ¸ ì¶”ê°€ (ëª¨ë°”ì¼ ëŒ€ì‘)
                canvasContainer.addEventListener('touchstart', (e) => {
                    if (e.target !== canvasContainer) return;
                    isDraggingCanvas = true;
                    const touch = e.touches[0];
                    dragStartX = touch.clientX - translateX;
                    dragStartY = touch.clientY - translateY;
                    e.preventDefault();
                });

                document.addEventListener('touchmove', (e) => {
                    if (!isDraggingCanvas) return;
                    const touch = e.touches[0];
                    translateX = touch.clientX - dragStartX;
                    translateY = touch.clientY - dragStartY;
                    updateTransform();
                    e.preventDefault();
                });

                document.addEventListener('touchend', () => {
                    isDraggingCanvas = false;
                });
            }

            // íˆ¬ëª…ë„ ì¡°ì ˆ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupOpacityControls() {
                opacitySlider.addEventListener('input', () => {
                    const opacity = opacitySlider.value;
                    opacityValue.textContent = `${opacity}%`;
                    
                    // ëª¨ë“  ë©”ëª¨ì— íˆ¬ëª…ë„ ì ìš©
                    document.querySelectorAll('.note').forEach(note => {
                        note.style.opacity = opacity / 100;
                    });
                    
                    // í˜„ì¬ ìº”ë²„ìŠ¤ê°€ ìˆìœ¼ë©´ íˆ¬ëª…ë„ ì„¤ì • ì €ì¥
                    if (currentCanvasId) {
                        canvases[currentCanvasId].opacity = opacity / 100;
                        saveCurrentCanvas();
                    }
                });
            }

            function showNewCanvasModal() {
                newCanvasTitleInput.value = '';
                newCanvasModal.style.display = 'flex';
                newCanvasTitleInput.focus();
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            function setupEventListeners() {
                addNoteBtn.addEventListener('click', () => {
                    createNote();
                });

                document.getElementById('new-canvas-btn').addEventListener('click', () => {
                    createNewCanvas();
                });

                // ìº”ë²„ìŠ¤ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                document.getElementById('delete-canvas-btn').addEventListener('click', () => {
                    if (!currentCanvasId) return;
                    
                    if (confirm('ì •ë§ë¡œ ì´ ìº”ë²„ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œ í›„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                        deleteCanvas(currentCanvasId);
                    }
                });

                // ìº”ë²„ìŠ¤ ë¹„ìš°ê¸° ë²„íŠ¼ ì¶”ê°€
                document.getElementById('clear-canvas-btn').addEventListener('click', () => {
                    if (!currentCanvasId) return;
                    
                    if (confirm('í˜„ì¬ ìº”ë²„ìŠ¤ì˜ ëª¨ë“  ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        clearCurrentCanvas();
                    }
                });

                // ìƒˆ ìº”ë²„ìŠ¤ ë²„íŠ¼ - ëª¨ë‹¬ í‘œì‹œë¡œ ë³€ê²½
                document.getElementById('new-canvas-btn').addEventListener('click', () => {
                    showNewCanvasModal();
                });

                // ëª¨ë‹¬ í™•ì¸ ë²„íŠ¼
                confirmNewCanvasBtn.addEventListener('click', () => {
                    const title = newCanvasTitleInput.value.trim();
                    if (title) {
                        createNewCanvas(title);
                        newCanvasModal.style.display = 'none';
                    } else {
                        alert('ìº”ë²„ìŠ¤ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    }
                });

                // ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼
                cancelNewCanvasBtn.addEventListener('click', () => {
                    newCanvasModal.style.display = 'none';
                    
                    // ìº”ë²„ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìº”ë²„ìŠ¤ ìƒì„±
                    if (Object.keys(canvases).length === 0) {
                        createNewCanvas('ìƒˆ ìº”ë²„ìŠ¤');
                    }
                });

                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                newCanvasModal.addEventListener('click', (e) => {
                    if (e.target === newCanvasModal) {
                        newCanvasModal.style.display = 'none';
                        
                        // ìº”ë²„ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìº”ë²„ìŠ¤ ìƒì„±
                        if (Object.keys(canvases).length === 0) {
                            createNewCanvas('ìƒˆ ìº”ë²„ìŠ¤');
                        }
                    }
                });

                canvasTitleInput.addEventListener('change', () => {
                    if (!currentCanvasId) return;
                    
                    const newTitle = canvasTitleInput.value.trim();
                    if (!newTitle) return;
                    
                    // ì œëª©ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
                    if (newTitle !== canvases[currentCanvasId].title) {
                        saveAsNewCanvas(newTitle);
                    }
                });
                
                zoomInBtn.addEventListener('click', () => {
                    zoom(1.1);
                });
                
                zoomOutBtn.addEventListener('click', () => {
                    zoom(0.9);
                });
                
                zoomResetBtn.addEventListener('click', () => {
                    resetZoom();
                });
                
                canvasSelect.addEventListener('change', (e) => {
                    if (e.target.value) {
                        loadCanvas(e.target.value);
                    }
                });
                
                saveCanvasBtn.addEventListener('click', () => {
                    saveCurrentCanvas();
                });
                
                exportBtn.addEventListener('click', () => {
                    exportCanvases();
                });
                
                importBtn.addEventListener('click', () => {
                    importCanvases();
                });
                
                
            }
            
            // í™•ëŒ€/ì¶•ì†Œ í•¨ìˆ˜
            function zoom(factor) {
                scale *= factor;
                updateTransform();
                updateZoomLevel();
            }
            
            // í™•ëŒ€/ì¶•ì†Œ ë¦¬ì…‹
            function resetZoom() {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
                updateZoomLevel();
            }
            
            // ë³€í™˜ ì—…ë°ì´íŠ¸
            function updateTransform() {
                const canvas = document.getElementById('canvas');
                canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                console.log("í˜„ì¬ ìœ„ì¹˜:", translateX, translateY); // ë””ë²„ê¹…ìš©             
            }
            
            // í™•ëŒ€ ë ˆë²¨ í‘œì‹œ ì—…ë°ì´íŠ¸
            function updateZoomLevel() {
                zoomLevelDisplay.textContent = `${Math.round(scale * 100)}%`;
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìº”ë²„ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
            function loadCanvasesFromLocalStorage() {
                const savedCanvases = localStorage.getItem('stickyNotesCanvases');
                if (savedCanvases) {
                    canvases = JSON.parse(savedCanvases);
                }
            }
            
            // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            function updateCanvasSelect() {
                canvasSelect.innerHTML = '';
                
                Object.keys(canvases).forEach(canvasId => {
                    const option = document.createElement('option');
                    option.value = canvasId;
                    option.textContent = canvases[canvasId].title || `ìº”ë²„ìŠ¤ ${canvasId}`;
                    canvasSelect.appendChild(option);
                });
                
                // í˜„ì¬ ì„ íƒëœ ìº”ë²„ìŠ¤ í‘œì‹œ
                if (currentCanvasId) {
                    canvasSelect.value = currentCanvasId;
                }
            }
            
            // ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
            function createNewCanvas(title) {
                if (!title || !title.trim()) {
                    alert('ìº”ë²„ìŠ¤ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return null;
                }
                
                const newCanvasId = Date.now().toString();
                currentCanvasId = newCanvasId;
                
                canvases[newCanvasId] = {
                    id: newCanvasId,
                    title: title.trim(),
                    notes: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    opacity: 1 // ê¸°ë³¸ íˆ¬ëª…ë„
                };
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
                
                // ì œëª© ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                canvasTitleInput.value = title.trim();
                
                // íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
                opacitySlider.value = 100;
                opacityValue.textContent = '100%';
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                return newCanvasId;
            }
            
            // ìº”ë²„ìŠ¤ ë¡œë“œ
            function loadCanvas(canvasId) {
                if (!canvases[canvasId]) return;
                
                currentCanvasId = canvasId;
                const canvasData = canvases[canvasId];
                
                // ì œëª© í‘œì‹œ
                canvasTitleInput.value = canvasData.title || '';
                
                // íˆ¬ëª…ë„ ì„¤ì •
                const opacity = canvasData.opacity !== undefined ? canvasData.opacity : 1;
                opacitySlider.value = opacity * 100;
                opacityValue.textContent = `${opacity * 100}%`;
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë…¸íŠ¸ ë¡œë“œ
                if (canvasData.notes && canvasData.notes.length > 0) {
                    canvasData.notes.forEach(note => {
                        createNote(
                            note.content, 
                            note.type, 
                            note.position, 
                            note.id,
                            note.size, // í¬ê¸° ì •ë³´ ì¶”ê°€
                            note.opacity // íˆ¬ëª…ë„ ì •ë³´ ì¶”ê°€
                        );
                    });
                }
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }
            
            // í˜„ì¬ ìº”ë²„ìŠ¤ ì €ì¥
            function saveCurrentCanvas() {
                if (!currentCanvasId) return;
                
                const title = canvasTitleInput.value.trim();
                
                // ìº”ë²„ìŠ¤ ë°ì´í„° ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ìº”ë²„ìŠ¤ ì—…ë°ì´íŠ¸)
                canvases[currentCanvasId].title = title;
                canvases[currentCanvasId].updatedAt = new Date().toISOString();
                canvases[currentCanvasId].opacity = parseFloat(opacitySlider.value) / 100;
                
                // ë…¸íŠ¸ ë°ì´í„° ìˆ˜ì§‘
                const notes = [];
                const noteElements = document.querySelectorAll('.note');
                
                noteElements.forEach(note => {
                    notes.push({
                        id: note.id,
                        content: note.querySelector('.note-content').value,
                        type: note.querySelector('.note-type').textContent,
                        position: {
                            left: note.style.left,
                            top: note.style.top
                        },
                        size: { // í¬ê¸° ì •ë³´ ì €ì¥
                            width: note.style.width,
                            height: note.style.height
                        },
                        opacity: parseFloat(note.style.opacity || '1'), // íˆ¬ëª…ë„ ì •ë³´ ì €ì¥
                        createdAt: note.querySelector('.note-footer').textContent
                    });
                });
                
                canvases[currentCanvasId].notes = notes;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }
            
            // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
            function clearCanvas() {
                canvas.innerHTML = '';
            }

            // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupContextMenu() {
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆì—ì„œ ìš°í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
                canvasContainer.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    
                    // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ì €ì¥
                    lastRightClickPosition = {
                        x: e.clientX,
                        y: e.clientY
                    };
                    
                    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìœ„ì¹˜ ì„¤ì •
                    contextMenu.style.display = 'block';
                    contextMenu.style.left = `${e.clientX}px`;
                    contextMenu.style.top = `${e.clientY}px`;
                });

                // ë¬¸ì„œ í´ë¦­ ì‹œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìˆ¨ê¸°ê¸°
                document.addEventListener('click', () => {
                    contextMenu.style.display = 'none';
                });

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
                contextAddNote.addEventListener('click', () => {
                    // ë©”ëª¨ ì¶”ê°€ ê¸°ëŠ¥
                    createNoteAtPosition(lastRightClickPosition);
                    contextMenu.style.display = 'none';
                });

                contextAlignNotes.addEventListener('click', () => {
                    // ë©”ëª¨ ì •ë ¬ ê¸°ëŠ¥
                    alignNotesFromPosition(lastRightClickPosition);
                    contextMenu.style.display = 'none';
                });
            }

            // ìœ„ì¹˜ì— ë©”ëª¨ ìƒì„± í•¨ìˆ˜ ì¶”ê°€
            function createNoteAtPosition(position) {
                if (!currentCanvasId) return;
                
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
                const containerRect = canvasContainer.getBoundingClientRect();
                const x = position.x - containerRect.left - translateX;
                const y = position.y - containerRect.top - translateY;
                
                // ìŠ¤ì¼€ì¼ ê³ ë ¤
                const scaledX = x / scale;
                const scaledY = y / scale;
                
                // ë©”ëª¨ ìƒì„±
                const noteId = createNote('', defaultNoteType, {
                    left: `${scaledX}px`,
                    top: `${scaledY}px`
                });
                
                // ì €ì¥
                saveCurrentCanvas();
                
                return noteId;
            }

            // ì‹œì‘ì  ê¸°ì¤€ìœ¼ë¡œ ë©”ëª¨ ì •ë ¬ í•¨ìˆ˜ ì¶”ê°€
            function alignNotesFromPosition(startPosition) {
                if (!currentCanvasId || !canvases[currentCanvasId] || !canvases[currentCanvasId].notes) return;
                
                // ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
                const containerRect = canvasContainer.getBoundingClientRect();
                const startX = (startPosition.x - containerRect.left - translateX) / scale;
                const startY = (startPosition.y - containerRect.top - translateY) / scale;
                
                // ë©”ëª¨ì§€ í¬ê¸° ë° ê°„ê²©
                const noteWidth = 200; // ë©”ëª¨ì§€ ë„ˆë¹„
                const noteHeight = 200; // ë©”ëª¨ì§€ ë†’ì´
                const margin = 20; // ê°„ê²©
                
                // ë©”ëª¨ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ìƒì„± ì‹œê°„ ê¸°ì¤€ ì •ë ¬)
                const notes = [...canvases[currentCanvasId].notes];
                notes.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                
                // ë©”ëª¨ì§€ DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                const noteElements = Array.from(document.querySelectorAll('.note'));
                
                // ë©”ëª¨ì§€ ì •ë ¬
                notes.forEach((note, index) => {
                    const noteElement = noteElements.find(el => el.id === note.id);
                    if (!noteElement) return;
                    
                    // í–‰/ì—´ ê³„ì‚° (í•œ ì¤„ì— 5ê°œ)
                    const row = Math.floor(index / 5);
                    const col = index % 5;
                    
                    // ìœ„ì¹˜ ê³„ì‚°
                    const x = startX + col * (noteWidth + margin);
                    const y = startY + row * (noteHeight + margin);
                    
                    // ìœ„ì¹˜ ì ìš©
                    noteElement.style.left = `${x}px`;
                    noteElement.style.top = `${y}px`;
                    
                    // ë°ì´í„° ì—…ë°ì´íŠ¸
                    note.position = {
                        left: `${x}px`,
                        top: `${y}px`
                    };
                });
                
                // ìº”ë²„ìŠ¤ ë°ì´í„° ì—…ë°ì´íŠ¸
                canvases[currentCanvasId].notes = notes;
                saveCurrentCanvas();
            }
            
            // ë…¸íŠ¸ ìƒì„± í•¨ìˆ˜ (í¬ê¸°ì™€ íˆ¬ëª…ë„ íŒŒë¼ë¯¸í„° ì¶”ê°€)
            function createNote(content = '', type = defaultNoteType, position = null, noteId = null, size = null, noteOpacity = null) {
                noteId = noteId || Date.now().toString();
                const note = document.createElement('div');
                note.className = 'note';
                note.id = noteId;
                note.style.backgroundColor = noteTypes[type] || noteTypes[defaultNoteType];
                
                // íˆ¬ëª…ë„ ì ìš© (ê°œë³„ ë…¸íŠ¸ íˆ¬ëª…ë„ ë˜ëŠ” ì „ì²´ íˆ¬ëª…ë„)
                const opacity = noteOpacity !== null ? noteOpacity : parseFloat(opacitySlider.value) / 100;
                note.style.opacity = opacity;
                
                // ìœ„ì¹˜ ì„¤ì •
                if (position) {
                    note.style.left = position.left;
                    note.style.top = position.top;
                } else {
                    // í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜
                    const canvasRect = canvas.getBoundingClientRect();
                    note.style.left = `${canvasRect.width / 2 - 100}px`;
                    note.style.top = `${canvasRect.height / 2 - 100}px`;
                }
                
                // í¬ê¸° ì„¤ì •
                if (size && size.width && size.height) {
                    note.style.width = size.width;
                    note.style.height = size.height;
                } else {
                    note.style.width = '200px';
                    note.style.height = '200px';
                }
                
                // ë…¸íŠ¸ ë‚´ìš©
                note.innerHTML = `
                    <div class="note-header">
                        <span class="note-type">${type}</span>
                        <div class="note-actions">
                            <button class="change-type-btn">âœï¸</button>
                            <button class="delete-btn">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <textarea class="note-content" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">${content}</textarea>
                    <div class="note-footer">${new Date().toLocaleDateString()}
                        <div class="resize-handle"></div>
                    </div>
                `;
                
                canvas.appendChild(note);
                
                // ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€
                makeDraggable(note);
                
                // í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ ì¶”ê°€
                setupResizeHandle(note);
                
                // ë…¸íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                const deleteBtn = note.querySelector('.delete-btn');
                const changeTypeBtn = note.querySelector('.change-type-btn');
                const noteContent = note.querySelector('.note-content');
                
                deleteBtn.addEventListener('click', () => {
                    deleteNote(noteId);
                });
                
                changeTypeBtn.addEventListener('click', () => {
                    changeNoteType(noteId);
                });
                
                noteContent.addEventListener('input', () => {
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                });
                
                return noteId;
            }
            
            // ë…¸íŠ¸ ë“œë˜ê·¸ ê¸°ëŠ¥
            function makeDraggable(note) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                let isDragging = false;
            
                function dragMouseDown(e) {
                    // ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ì„ í´ë¦­í•œ ê²½ìš° ë“œë˜ê·¸ ê¸ˆì§€
                    if (e.target.classList.contains('resize-handle')) {
                        return;
                    }
                    
                    // í…ìŠ¤íŠ¸ í¸ì§‘ ì¤‘ì—ëŠ” ë“œë˜ê·¸ ê¸ˆì§€
                    if (e.target.tagName === 'TEXTAREA') {
                        return;
                    }
                    
                    e.preventDefault();
                    
                    // ë“œë˜ê·¸ ì‹œì‘ ìœ„ì¹˜
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                    note.style.cursor = 'grabbing';
                    isDragging = true;
                }
                
                function elementDrag(e) {
                    if (!isDragging) return;
                    
                    e = e || window.event;
                    e.preventDefault();
                    
                    // ìƒˆ ìœ„ì¹˜ ê³„ì‚°
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    
                    // ë…¸íŠ¸ ìœ„ì¹˜ ì„¤ì • (ìŠ¤ì¼€ì¼ ê³ ë ¤)
                    const currentLeft = parseFloat(note.style.left || '0');
                    const currentTop = parseFloat(note.style.top || '0');
                    
                    note.style.left = (currentLeft - pos1 / scale) + "px";
                    note.style.top = (currentTop - pos2 / scale) + "px";
                    
                    // ìœ„ì¹˜ ë³€ê²½ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                    note.style.cursor = 'grab';
                    isDragging = false;
                }
                
                note.onmousedown = dragMouseDown;
            }
            
            // ë…¸íŠ¸ í¬ê¸° ì¡°ì ˆ í•¸ë“¤ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupResizeHandle(note) {
                const resizeHandle = note.querySelector('.resize-handle');
                let startX, startY, startWidth, startHeight;
                
                resizeHandle.addEventListener('mousedown', initResize);
                
                function initResize(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // ì‹œì‘ ìœ„ì¹˜ ë° í¬ê¸° ì €ì¥
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = parseInt(document.defaultView.getComputedStyle(note).width, 10);
                    startHeight = parseInt(document.defaultView.getComputedStyle(note).height, 10);
                    
                    document.onmousemove = resize;
                    document.onmouseup = stopResize;
                }
                
                function resize(e) {
                    // ìµœì†Œ í¬ê¸° ì„¤ì • (100px)
                    const minWidth = 100;
                    const minHeight = 100;
                    
                    // ìƒˆ í¬ê¸° ê³„ì‚°
                    let newWidth = startWidth + (e.clientX - startX) / scale;
                    let newHeight = startHeight + (e.clientY - startY) / scale;
                    
                    // ìµœì†Œ í¬ê¸° ì œí•œ
                    newWidth = Math.max(newWidth, minWidth);
                    newHeight = Math.max(newHeight, minHeight);
                    
                    // í¬ê¸° ì ìš©
                    note.style.width = `${newWidth}px`;
                    note.style.height = `${newHeight}px`;
                }
                
                function stopResize() {
                    document.onmousemove = null;
                    document.onmouseup = null;
                    
                    // í¬ê¸° ë³€ê²½ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
            }
            
            // ë…¸íŠ¸ íƒ€ì… ë³€ê²½
            function changeNoteType(noteId) {
                const note = document.getElementById(noteId);
                if (!note) return;
                
                const currentType = note.querySelector('.note-type').textContent;
                const types = Object.keys(noteTypes);
                const currentIndex = types.indexOf(currentType);
                const nextIndex = (currentIndex + 1) % types.length;
                const nextType = types[nextIndex];
                
                note.querySelector('.note-type').textContent = nextType;
                note.style.backgroundColor = noteTypes[nextType];
                
                // íƒ€ì… ë³€ê²½ ì‹œ ìë™ ì €ì¥
                if (currentCanvasId) {
                    saveCurrentCanvas();
                }
            }

            // ê²€ìƒ‰ ê¸°ëŠ¥ ì„¤ì • í•¨ìˆ˜ ì¶”ê°€
            function setupSearch() {
                // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                searchBtn.addEventListener('click', () => {
                    console.log('ê²€ìƒ‰ë²„íŠ¼ ëˆ„ë¦„');
                    const term = searchInput.value.trim();
                    if (term) {
                        searchNotes(term);
                    }
                });

                // ì´ì „ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                prevBtn.addEventListener('click', () => {
                    console.log('ì´ì „ë²„íŠ¼ ëˆ„ë¦„');
                    navigateSearchResult(-1); // -1ì€ ì´ì „ ê²°ê³¼ë¡œ ì´ë™
                });

                // ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                nextBtn.addEventListener('click', () => {
                    console.log('ë‹¤ìŒë²„íŠ¼ ëˆ„ë¦„');
                    navigateSearchResult(1); // 1ì€ ë‹¤ìŒ ê²°ê³¼ë¡œ ì´ë™
                });

                // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰ ê°€ëŠ¥
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const term = searchInput.value.trim();
                        if (term) {
                            searchNotes(term);
                        }
                    }
                });
            }

            // í•˜ì´ë¼ì´íŠ¸ ì œê±° í•¨ìˆ˜ ìˆ˜ì • (ë²„íŠ¼ ìƒíƒœë„ í•¨ê»˜ ì—…ë°ì´íŠ¸)
            function clearHighlights() {
                document.querySelectorAll('.note.highlighted').forEach(note => {
                    note.classList.remove('highlighted');
                });
            }

            // ë©”ëª¨ ê²€ìƒ‰ í•¨ìˆ˜ ì¶”ê°€
            function searchNotes(term) {
                if (!currentCanvasId || !canvases[currentCanvasId]) return;
                
                 // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearHighlights();
                
                // ê²€ìƒ‰ì–´ ì €ì¥
                currentSearchTerm = term;
                
                // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
                searchResults = [];
                
                // í˜„ì¬ ìº”ë²„ìŠ¤ì˜ ëª¨ë“  ë©”ëª¨ì—ì„œ ê²€ìƒ‰
                const notes = canvases[currentCanvasId].notes;
                notes.forEach(note => {
                    const noteElement = document.getElementById(note.id);
                    if (noteElement && note.content.includes(term)) {
                        searchResults.push(note.id);
                    }
                });
                
                if (searchResults.length > 0) {
                    currentSearchIndex = 0;
                    highlightNote(searchResults[currentSearchIndex]);
                    centerNote(searchResults[currentSearchIndex]);
                    
                    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateSearchButtons();
                } else {
                    alert('ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    currentSearchIndex = -1;
                    updateSearchButtons();
                }
                console.log('ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´:', searchResults);  // ë””ë²„ê¹…
            }

            // ê²€ìƒ‰ ê²°ê³¼ íƒìƒ‰ í•¨ìˆ˜ ì¶”ê°€
            function navigateSearchResult(direction) {
                if (searchResults.length === 0) return;
            
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearHighlights();
                
                // ìƒˆë¡œìš´ ì¸ë±ìŠ¤ ê³„ì‚° (ìˆœí™˜)
                console.log('currentSearchIndex : '+ currentSearchIndex);
                console.log('ì¶”ê°€í•  ìˆ«ì : '+ direction);
                currentSearchIndex += direction;
                console.log('ì´ë™í•  ìˆœë²ˆ : '+ currentSearchIndex);
                console.log('searchResults.length : '+ searchResults.length);
                if (currentSearchIndex >= searchResults.length) {
                    currentSearchIndex = 0; // ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°
                } else if (currentSearchIndex < 0) {
                    currentSearchIndex = searchResults.length - 1; // ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë™
                }
                
                // ìƒˆ ë©”ëª¨ í•˜ì´ë¼ì´íŠ¸ ë° ì¤‘ì•™ ì •ë ¬
                highlightNote(searchResults[currentSearchIndex]);
                centerNote(searchResults[currentSearchIndex]);
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateSearchButtons();
            }

            // ë©”ëª¨ í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
            function highlightNote(noteId) {
                const note = document.getElementById(noteId);
                if (note) {
                    note.classList.add('highlighted');
                }
            }

            // ë©”ëª¨ë¥¼ ì¤‘ì•™ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
            function centerNote(noteId) {
                const note = document.getElementById(noteId);
                if (!note) return;
                
                // ë©”ëª¨ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const noteRect = note.getBoundingClientRect();
                const containerRect = canvasContainer.getBoundingClientRect();
                
                // ë©”ëª¨ì˜ ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
                const noteCenterX = noteRect.left + noteRect.width / 2;
                const noteCenterY = noteRect.top + noteRect.height / 2;
                
                // ì»¨í…Œì´ë„ˆì˜ ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
                const containerCenterX = containerRect.width / 2;
                const containerCenterY = containerRect.height / 2;
                
                // ì´ë™í•´ì•¼ í•  ê±°ë¦¬ ê³„ì‚°
                const moveX = containerCenterX - noteCenterX;
                const moveY = containerCenterY - noteCenterY;
                
                // í˜„ì¬ ë³€í™˜ ê°’ì— ì´ë™ ê±°ë¦¬ ì¶”ê°€
                translateX += moveX;
                translateY += moveY;
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                updateTransform();
            }

            // ê²€ìƒ‰ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
            function updateSearchButtons() {
                prevBtn.disabled = searchResults.length === 0;
                nextBtn.disabled = searchResults.length === 0;
                
                if (searchInput.value.trim() !== currentSearchTerm) {
                    searchBtn.disabled = false;
                    prevBtn.disabled = true;
                    nextBtn.disabled = true;
                } else {
                    searchBtn.disabled = false;
                }
            }

            // ìƒˆ ìº”ë²„ìŠ¤ë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
            function saveAsNewCanvas(title) {
                if (!currentCanvasId) return;
                
                const oldCanvas = canvases[currentCanvasId];
                const newCanvasId = Date.now().toString();
                
                // ìƒˆ ìº”ë²„ìŠ¤ ìƒì„± (ê¸°ì¡´ ë°ì´í„° ë³µì‚¬)
                canvases[newCanvasId] = {
                    id: newCanvasId,
                    title: title,
                    notes: JSON.parse(JSON.stringify(oldCanvas.notes)), // ê¹Šì€ ë³µì‚¬
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    opacity: parseFloat(opacitySlider.value) / 100 // í˜„ì¬ íˆ¬ëª…ë„ ì €ì¥
                };
                
                // í˜„ì¬ ìº”ë²„ìŠ¤ ID ì—…ë°ì´íŠ¸
                currentCanvasId = newCanvasId;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // UI ì—…ë°ì´íŠ¸
                updateCanvasSelect();
                
                // ì œëª© í•„ë“œì— ìƒˆ ì œëª© í‘œì‹œ
                canvasTitleInput.value = title;
                
                alert('ìƒˆ ìº”ë²„ìŠ¤ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            // ìº”ë²„ìŠ¤ ì‚­ì œ í•¨ìˆ˜ ì¶”ê°€
            function deleteCanvas(canvasId) {
                if (!canvases[canvasId]) return;
                
                // ìº”ë²„ìŠ¤ ì‚­ì œ
                delete canvases[canvasId];
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                
                // ë‹¤ë¥¸ ìº”ë²„ìŠ¤ê°€ ìˆëŠ” ê²½ìš° ì²« ë²ˆì§¸ ìº”ë²„ìŠ¤ ë¡œë“œ
                if (Object.keys(canvases).length > 0) {
                    const firstCanvasId = Object.keys(canvases)[0];
                    loadCanvas(firstCanvasId);
                } else {
                    // ìº”ë²„ìŠ¤ê°€ ì—†ëŠ” ê²½ìš° ìƒˆ ìº”ë²„ìŠ¤ ìƒì„±
                    createNewCanvas();
                }
                
                // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCanvasSelect();
            }

            // í˜„ì¬ ìº”ë²„ìŠ¤ ë¹„ìš°ê¸° í•¨ìˆ˜ ì¶”ê°€
            function clearCurrentCanvas() {
                if (!currentCanvasId) return;
                
                // ìº”ë²„ìŠ¤ ë‚´ìš© ì´ˆê¸°í™”
                clearCanvas();
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                canvases[currentCanvasId].notes = [];
                canvases[currentCanvasId].updatedAt = new Date().toISOString();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
            }

            // ë…¸íŠ¸ ì‚­ì œ
            function deleteNote(noteId) {
                const note = document.getElementById(noteId);
                if (note) {
                    note.remove();
                    // ë…¸íŠ¸ ì‚­ì œ ì‹œ ìë™ ì €ì¥
                    if (currentCanvasId) {
                        saveCurrentCanvas();
                    }
                }
            }
            
            // ìº”ë²„ìŠ¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            function exportCanvases() {
                if (Object.keys(canvases).length === 0) {
                    alert('ë‚´ë³´ë‚¼ ìº”ë²„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const dataStr = JSON.stringify(canvases, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `sticky-notes-${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
            
            // ìº”ë²„ìŠ¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            function importCanvases() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const importedCanvases = JSON.parse(event.target.result);
                            
                            // ê¸°ì¡´ ìº”ë²„ìŠ¤ì™€ ë³‘í•©
                            canvases = { ...canvases, ...importedCanvases };
                            
                            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                            localStorage.setItem('stickyNotesCanvases', JSON.stringify(canvases));
                            
                            // ìº”ë²„ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                            updateCanvasSelect();
                            
                            // ì²« ë²ˆì§¸ ìº”ë²„ìŠ¤ ë¡œë“œ
                            const firstCanvasId = Object.keys(importedCanvases)[0];
                            loadCanvas(firstCanvasId);
                            
                            alert('ìº”ë²„ìŠ¤ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.');
                        } catch (error) {
                            alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            }
        });
    </script>
</body>
</html>
